## 웹 패킷의 여정: 클라이언트에서 서버까지

사용자가 웹 브라우저에 주소를 입력하는 순간부터 웹 페이지가 뜨기까지, 데이터 조각(패킷)이 어떤 길을 거치는지 단계별로 정리한 내용입니다. 이 과정을 거대한 편지 배송 시스템에 비유할 수 있습니다.
<br>

### **1단계: 클라이언트  - 요청 생성 및 발송**

사용자의 컴퓨터에서 웹 서버로 보낼 요청 편지를 만들고 포장하는 과정입니다.

1. **URL 입력 및 해석 (웹 브라우저)**
    - 사용자가 `www.example.com`과 같은 URL을 입력합니다.
    - 웹 브라우저는 URL을 해석하여 "이 주소의 홈페이지를 보여줘"라는 내용의 **HTTP 요청 메시지**를 생성합니다.
2. **데이터 전송 위임 (Socket 라이브러리)**
    - 브라우저는 생성된 HTTP 메시지를 운영체제(OS)의 **Socket 라이브러리**에 전달하며 "이 데이터를 저 주소로 보내줘"라고 요청합니다.
3. **데이터 포장 (프로토콜 스택)**
    - **TCP 담당**: 메시지를 전송하기 좋은 크기로 **분할**하고, 각 조각에 순서와 통신 규칙이 담긴 **TCP 헤더**를 붙입니다. (택배 상자에 내용물을 나누어 담고, 각 상자에 번호를 매기는 것과 비슷합니다.)
    - **IP 담당**: TCP에서 받은 데이터 조각에 최종 목적지 주소(**웹 서버의 IP 주소**)와 출발지 주소가 담긴 **IP 헤더**를 붙입니다.
    - **MAC 담당**: 이제 다음으로 전달할 장비(바로 옆 공유기 또는 라우터)의 물리적 주소(**MAC 주소**)가 담긴 **MAC 헤더**를 붙여 최종적으로 전송할 패킷을 완성합니다.
4. **전기 신호로 변환 및 전송 (LAN 어댑터)**
    - 완성된 디지털 데이터 패킷을 **LAN 어댑터**(랜카드)가 **전기 신호**로 변환하여 랜선(트위스트 페어 케이블)으로 내보냅니다.

> 핵심 정리
> 
> 
> IP 주소는 최종 목적지(집 주소)이고, MAC 주소는 바로 다음 거점(동네 우체국)의 주소입니다. 라우터를 거칠 때마다 MAC 주소는 계속 바뀌지만 IP 주소는 바뀌지 않습니다.
> 

---
<br>

### **2단계: 인터넷  - 수많은 장비를 거치는 여행**

이제 전기 신호가 된 패킷은 웹 서버를 향한 긴 여행을 시작합니다.

1. **내부 네트워크 (스위칭 허브, 라우터)**
    - 패킷은 **스위칭 허브**를 통해 내부 네트워크의 출입구인 **라우터**로 전달됩니다.
    - **라우터**는 패킷의 **IP 주소**를 보고, 자신이 가진 **라우팅 테이블**(경로 정보)을 참고하여 인터넷 세상으로 나가는 가장 좋은 다음 경로로 패킷을 중계합니다.
2. **인터넷 서비스 제공업체(ISP) 접속**
    - 패킷은 ADSL 모뎀, 전화선 등을 통해 통신사의 **DSLAM**(신호 집중 장치)에 도착합니다.
    - **BAS**(광대역 접속 서버)에서 사용자를 인증하고, 패킷이 인터넷의 중심부로 나아갈 수 있도록 터널링(PPPoE, L2TP 등) 기술을 통해 다시 한번 포장합니다.
3. **인터넷 핵심망**
    - 패킷은 전 세계에 거미줄처럼 연결된 수많은 **라우터**들을 거쳐갑니다. 각 라우터들은 목적지 IP 주소만을 보고 최적의 다음 경로로 패킷을 계속해서 전달(라우팅)합니다.

---
<br>

### **3단계: 웹 서버 - 목적지 도착 및 요청 처리**

길고 긴 여행 끝에 패킷이 마침내 목적지인 웹 서버의 네트워크에 도착합니다.

1. **보안 검사 (방화벽)**
    - 서버 측 네트워크의 입구에 있는 **방화벽**이 패킷을 검사하여 유해하거나 규칙에 어긋나는 패킷을 차단합니다.
2. **요청 가로채기 (캐시 서버)**
    - 만약 **캐시 서버**가 있다면, 방화벽을 통과한 패킷을 먼저 확인합니다.
    - 사용자가 요청한 데이터가 캐시에 저장되어 있다면, 굳이 웹 서버까지 가지 않고 바로 응답을 보내주어 속도를 높입니다.
    - 데이터가 없다면 패킷을 원래 목적지인 웹 서버로 그대로 전달합니다.
3. **패킷 수신 및 데이터 복원 (웹 서버)**
    - **LAN 어댑터**: 서버에 도착한 전기 신호를 다시 디지털 데이터 패킷으로 변환합니다.
    - **프로토콜 스택**: 패킷의 포장을 역순으로 해체합니다. (MAC 헤더 제거 → IP 헤더 제거 → TCP 헤더 제거)
    - 분할되었던 데이터 조각들을 **TCP 헤더**의 순서 정보에 맞춰 원래의 **HTTP 요청 메시지**로 완벽하게 재조립합니다.
4. **요청 처리 및 응답 준비 (웹 서버 애플리케이션)**
    - 완전히 복원된 HTTP 메시지를 **웹 서버 애플리케이션**(Apache, Nginx 등)이 읽고, 사용자가 요청한 내용(예: "index.html 파일을 주세요")을 파악합니다.
    - 요청에 맞는 데이터(HTML 파일, 이미지 등)를 준비하여 클라이언트에게 보낼 **HTTP 응답 메시지**를 만듭니다.

---
<br>

### **4단계: 응답 - 다시 클라이언트에게로**

이제 웹 서버는 요청에 대한 응답을 클라이언트에게 되돌려 보냅니다. 이 과정은 **1~3단계의 과정을 정확히 반대로** 진행합니다.

- 웹 서버가 생성한 **HTTP 응답 메시지**를 다시 **TCP → IP → MAC 헤더** 순서로 포장합니다.
- 이때 **출발지 IP는 웹 서버, 목적지 IP는 클라이언트**가 됩니다.
- 패킷은 다시 인터넷의 수많은 라우터를 거쳐 클라이언트의 컴퓨터에 도착합니다.
- 클라이언트의 OS가 패킷을 받아 포장을 풀고, 웹 브라우저는 마침내 받은 데이터를 해석하여 우리 눈에 보이는 웹 페이지 화면으로 그려줍니다.
